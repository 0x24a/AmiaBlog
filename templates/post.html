{% extends "base.html" %}

{% block meta_description %}{{ post.metadata.description }}{% endblock %}
{% block meta_keywords %}{{ config.site_settings.keywords }}, {{ ', '.join(post.metadata.tags) }}{% endblock %}

{% block head_extra %}
    <script src="/static/markdown-it-14.1.0.min.js"></script>
    <script src="/static/markdown-it-footnote-4.0.0.min.js"></script>
    {% if hljs_languages %}
    <link rel="stylesheet" href="/static/hljs_11.1.1/amiablog.min.css">
    <script src="/static/hljs_11.1.1/highlight.min.js"></script>
    {% for language in hljs_languages %}
    <script src="/static/hljs_11.1.1/{{ language }}.min.js"></script>
    {% endfor %}
    {% endif %}
    <style>
    #markdown-render-result pre {
        width: 90%;
        overflow-x: auto;
        background-color: rgb(var(--mdui-color-surface-container-highest));
        padding: 1rem;
        padding-right: calc(10% - 1rem);
        border-radius: 0.5rem;
        margin: 1rem 0;
        white-space: pre;
        word-wrap: normal;
    }

    #markdown-render-result pre code {
        background-color: rgb(var(--mdui-color-surface-container-highest));
        display: block;
        overflow-x: auto;
        padding: 0;
    }
    </style>
{% endblock %}

{% block title %}{{ post.metadata.title }} - {{ config.site_settings.title }}{% endblock %}

{% block content %}
    <p style="font-size: xx-large;">{{ post.metadata.title }}</p>
    <p style="font-size: large;">{{ post.metadata.description }}</p>
    <br>
    {% for tag in post.metadata.tags %}
    <mdui-chip href="/tag/{{ tag | urlencode }}" target="_blank">{{ tag }}</mdui-chip>&nbsp;
    {% endfor %}
    <p style="display: flex; align-items: center; gap: 0.8rem; flex-wrap: wrap; color: rgb(var(--mdui-color-outline))">
      <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
        <mdui-icon name="person"></mdui-icon> {{ post.metadata.author }}
      </span>
      <span>|</span>
      <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
        <mdui-icon name="calendar_month"></mdui-icon> {{ post.metadata.date }}
      </span>
      <span>|</span>
      <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
        <mdui-icon name="edit"></mdui-icon> {{ post.metadata.last_modified }}
      </span>
    </p>
    <br>
    <mdui-divider></mdui-divider>
    <br>
    <br>
    <div id="markdown-render-result" class="mdui-prose">Rendering...</div>
    <br>
    <mdui-divider></mdui-divider>
    <br>
    <br>
    {% if copyright %}
      <div class="mdui-prose">
          <p>{{ i18n.copyright.format(copyright.name) }}&nbsp;<a href="{{ copyright.refer }}" target="_blank">{{ i18n.copyright_refer }}</a></p>
      </div>
    <br>
    <br>
    {% endif %}
    <pre style="display: none;" id="post-content">{{ post.content }}</pre>
{% endblock %}

{% block extra_scripts %}
    <script>
    function unescapeHtml(escapedStr) {
        var elem = document.createElement('textarea');
        elem.innerHTML = escapedStr;
        return elem.value;
    }
    const md = window.markdownit({
      html: true,
      linkify: true,
      typographer: true,
      breaks: true
    }).use(window.markdownitFootnote);
    const result = md.render(unescapeHtml(mdui.$('#post-content')[0].innerHTML));
    mdui.$('#markdown-render-result')[0].innerHTML=result;
    </script>
    {% if hljs_languages %}
    <script>hljs.highlightAll();</script>
    {% endif %}
{% endblock %}